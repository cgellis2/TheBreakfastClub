<!DOCTYPE html>
<html>
	<head>
		<script
src="https://code.jquery.com/jquery-3.2.1.js"
integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
crossorigin="anonymous"></script>
		<meta name="description" content="Coffee Chrome">
		<meta name="Keywords" content="overlay notification widget">
		<meta name="author" content="The Breakfast Club">
        <!--Bootstrap-->

        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <!--Ours-->
        <link rel="stylesheet" type="text/css" href="screen.css">


	</head>

	<body>

            <input type="image" id="icon" src="http://images.clipartpanda.com/coffee-clip-art-9TR5gzyTe.png" />
            <button type="button" id="butt" class="btn btn-success btn-sm" data-toggle="modal" data-target="#settings">Settings <i class="fa fa-cogs" aria-hidden="true"></i></button>

        <!--- Add & change apps -->
        <div class="modal fade" id="settings" tabindex="-1" role="dialog" aria-labelledby="settingsLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h3 class="modal-title" id="settings">Customize Your Layout</h3>


                    </div>

                        <div class="modal-body">
                            <div class="container col-md-12">
                                <div class="row">
                                    <div class = "col-md-10">
                                    <h4>Currently Displaying</h4>
                                    </div>
                                    <div class = "col-md-2">
                                        <h6>EDIT <i class="fa fa-pencil" font-size="15px" aria-hidden="true"></i></h6>
                                    </div>
                                </div>
                                <div class="row">
                                        <!--Gmail-->
                                        <div class="col-md-3">
                                        <input type="image" width=75% height=50% src="https://timedotcom.files.wordpress.com/2014/03/gmail-logo1.jpg?quality=85" />
                                            <h6>Gmail</h6>
                                        </div>

                                        <!--Calendar-->
                                         <div class="col-md-3">
                                             <input type="image" width=75% height=50% src="https://cdn4.iconfinder.com/data/icons/small-n-flat/24/calendar-512.png" />
                                             <h6>Calendar</h6>
                                         </div>

                                        <!--Messenger-->
                                         <div class="col-md-3">
                                             <input type="image" width=75% height=50% src="http://www.freeiconspng.com/uploads/facebook-chat-logo-png-19.png" />

                                            <h6>Messenger</h6></div>

                                        <!--Drive/Docs-->
                                        <div class="col-md-3">
                                            <input type="image" width=75% height=50% src="https://cnet4.cbsistatic.com/img/mpcTcd0ja3aUlSWPLq6t8CNbUkk=/fit-in/x/2016/06/21/86e39209-80a9-4b05-997e-b2d9ca6b1cc1/googledocs-ios.png" />
                                             <h6>Google Docs</h6>
                                        </div>
                                     </div>
                                <div class="row">
                                    <div class = "col-md-10">
                                    <h4>Available Apps</h4>
                                        <br>
                                    </div>
                                    <br>
                                </div>
                                <!--Available Apps-->

                                <div class="row">
                                        <!--Slack-->
                                        <div class="col-md-3">
                                            <input type="image" width=75% height=50% src="https://upload.wikimedia.org/wikipedia/commons/7/76/Slack_Icon.png" />
                                            <h6>Slack</h6>
                                        </div>

                                        <!--Facebook-->
                                         <div class="col-md-3">
                                             <input type="image" width=75% height=50% src="https://image.flaticon.com/icons/png/512/124/124010.png" />
                                             <h6>Facebook</h6>
                                         </div>

                                        <!--Trello-->
                                         <div class="col-md-3">
                                             <input type="image" width=75% height=50% src="https://s3.amazonaws.com/appforest_uf/f1505705090526x507083508884534200/trello.png" />
                                            <h6>Trello</h6></div>

                                        <!--Dropbox-->
                                        <div class="col-md-3">
                                            <input type="image" width=75% height=50% src="https://www.underconsideration.com/brandnew/archives/dropbox_logo_detail.png" />
                                            <h6>Dropbox</h6>
                                        </div>
                                     </div>
                                    <br>
                                </div>
                            </div>

                    <div class="modal-footer">

                        <!-- should we have a cancel button here? <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>  -->
                        <button type="button" data-dismiss="modal" class="btn btn-primary">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
				<main>
					<div>
						<input type="image" id="icon" onclick="createIcons()" src="http://images.clipartpanda.com/coffee-clip-art-9TR5gzyTe.png" value=0 />
					</div>
					<div id="widgetHere">
					</div>
					<div id="gmailHere">
					</div>
					<div id="messengerHere">
					</div>
					<div id="calendarHere">
					</div>
					<div id="driveHere">
					</div>
					<div id="widget">
					</div>


				</main>

				<script type="text/javascript">
					function createIcons() {
						if(document.getElementById("icon").value == 0 ) {
							var img1 = document.createElement("INPUT");
							img1.setAttribute("type", "image");
							img1.src = "mail.png";
							img1.setAttribute("id", "gmail");
							img1.setAttribute("value", 0);
							//img1.setAttribute("onclick", "createGmail()");
							document.getElementById("gmailHere").appendChild(img1);

							var img2 = document.createElement("INPUT");
							img2.setAttribute("type", "image");
							img2.src = "messenger.ico";
							img2.setAttribute("id", "messenger");
							img2.setAttribute("value", 0);
							img2.setAttribute("onclick", "createMessenger()");
							document.getElementById("messengerHere").appendChild(img2);

							var img3 = document.createElement("INPUT");
							img3.setAttribute("type", "image");
							img3.src = "calendar.jpg";
							img3.setAttribute("id", "calendar");
							img3.setAttribute("value", 0);
							img3.setAttribute("onclick", "createCalendar()");
							document.getElementById("calendarHere").appendChild(img3);

							var img4 = document.createElement("INPUT");
							img4.setAttribute("type", "image");
							img4.src = "drive.png";
							img4.setAttribute("id", "drive");
							img4.setAttribute("value", 0);
							img4.setAttribute("onclick", "createDrive()");
							document.getElementById("driveHere").appendChild(img4);

							document.getElementById("icon").setAttribute("value", 1);
						} else {
							document.getElementById("gmailHere").removeChild(document.getElementById("gmail"));
							document.getElementById("messengerHere").removeChild(document.getElementById("messenger"));
							document.getElementById("calendarHere").removeChild(document.getElementById("calendar"));
							document.getElementById("driveHere").removeChild(document.getElementById("drive"));

							document.getElementById("icon").setAttribute("value", 0);
						}
					}

				</script>

				<div id="api">
					<div class="container">

						<div class="title">
							<p>Gmail</p>
							<i id="window" class="fa fa-times" aria-hidden="true"></i>
							<a href="https://mail.google.com/mail/u/0/#inbox" target="_blank">
									<i id="expand" class="fa fa-arrow-up" aria-hidden="true"></i>
							</a>
						</div>

			      <button id="authorize-button" class="btn btn-primary hidden">Authorize</button>

			      <table class="table table-striped table-inbox hidden">
			        <thead>
			          <tr>
			            <th>From</th>
			            <th>Subject</th>
			            <th>Date/Time</th>
			          </tr>
			        </thead>
			        <tbody></tbody>
			      </table>
			    </div>

			    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
			    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

			    <script type="text/javascript">
			      var clientId = '836383984072-r33a54edonveag46qi5i388j1nqst4l7.apps.googleusercontent.com';
			      var apiKey = 'AIzaSyAtDG1n2Nb2wy5kyRcQjMmuJbu7K0Xa7AA';
			      var scopes = 'https://www.googleapis.com/auth/gmail.readonly';
			      function handleClientLoad() {
			        gapi.client.setApiKey(apiKey);
			        window.setTimeout(checkAuth, 1);
			      }
			      function checkAuth() {
			        gapi.auth.authorize({
			          client_id: clientId,
			          scope: scopes,
			          immediate: true
			        }, handleAuthResult);
			      }
			      function handleAuthClick() {
			        gapi.auth.authorize({
			          client_id: clientId,
			          scope: scopes,
			          immediate: false
			        }, handleAuthResult);
			        return false;
			      }
			      function handleAuthResult(authResult) {
			        if(authResult && !authResult.error) {
			          loadGmailApi();
			          $('#authorize-button').remove();
			          $('.table-inbox').removeClass("hidden");
			        } else {
			          $('#authorize-button').removeClass("hidden");
			          $('#authorize-button').on('click', function(){
			            handleAuthClick();
			          });
			        }
			      }
			      function loadGmailApi() {
			        gapi.client.load('gmail', 'v1', displayInbox);
			      }
			      function displayInbox() {
			        var request = gapi.client.gmail.users.messages.list({
			          'userId': 'me',
			          'labelIds': 'INBOX',
			          'maxResults': 10
			        });
			        request.execute(function(response) {
			          $.each(response.messages, function() {
			            var messageRequest = gapi.client.gmail.users.messages.get({
			              'userId': 'me',
			              'id': this.id
			            });
			            messageRequest.execute(appendMessageRow);
			          });
			        });
			      }
			      function appendMessageRow(message) {
			        $('.table-inbox tbody').append(
			          '<tr>\
			            <td>'+getHeader(message.payload.headers, 'From')+'</td>\
			            <td>\
			              <a href="#message-modal-' + message.id +
			                '" data-toggle="modal" id="message-link-' + message.id+'">' +
			                getHeader(message.payload.headers, 'Subject') +
			              '</a>\
			            </td>\
			            <td>'+getHeader(message.payload.headers, 'Date')+'</td>\
			          </tr>'
			        );
			        $('body').append(
			          '<div class="modal fade" id="message-modal-' + message.id +
			              '" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">\
			            <div class="modal-dialog modal-lg">\
			              <div class="modal-content">\
			                <div class="modal-header">\
			                  <button type="button"\
			                          class="close"\
			                          data-dismiss="modal"\
			                          aria-label="Close">\
			                    <span aria-hidden="true">&times;</span></button>\
			                  <h4 class="modal-title" id="myModalLabel">' +
			                    getHeader(message.payload.headers, 'Subject') +
			                  '</h4>\
			                </div>\
			                <div class="modal-body">\
			                  <iframe id="message-iframe-'+message.id+'" srcdoc="<p>Loading...</p>">\
			                  </iframe>\
			                </div>\
			              </div>\
			            </div>\
			          </div>'
			        );
			        $('#message-link-'+message.id).on('click', function(){
			          var ifrm = $('#message-iframe-'+message.id)[0].contentWindow.document;
			          $('body', ifrm).html(getBody(message.payload));
			        });
			      }
			      function getHeader(headers, index) {
			        var header = '';
			        $.each(headers, function(){
			          if(this.name === index){
			            header = this.value;
			          }
			        });
			        return header;
			      }
			      function getBody(message) {
			        var encodedBody = '';
			        if(typeof message.parts === 'undefined')
			        {
			          encodedBody = message.body.data;
			        }
			        else
			        {
			          encodedBody = getHTMLPart(message.parts);
			        }
			        encodedBody = encodedBody.replace(/-/g, '+').replace(/_/g, '/').replace(/\s/g, '');
			        return decodeURIComponent(escape(window.atob(encodedBody)));
			      }
			      function getHTMLPart(arr) {
			        for(var x = 0; x <= arr.length; x++)
			        {
			          if(typeof arr[x].parts === 'undefined')
			          {
			            if(arr[x].mimeType === 'text/html')
			            {
			              return arr[x].body.data;
			            }
			          }
			          else
			          {
			            return getHTMLPart(arr[x].parts);
			          }
			        }
			        return '';
			      }
			    </script>
			    <script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>
				</div>
    </body>
</html>
